<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to Data Science</title>
    <meta charset="utf-8" />
    <meta name="author" content="Simon Munzert" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
    <script src="https://tikzjax.com/v1/tikzjax.js"></script>
    <link rel="stylesheet" href="../simons-touch.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Introduction to Data Science
]
.subtitle[
## Session 3: Programming II
]
.author[
### Simon Munzert
]
.institute[
### Hertie School | <a href="https://github.com/intro-to-data-science-25">GRAD-C11/E1339</a>
]

---



&lt;style type="text/css"&gt;
@media print { # print out incremental slides; see https://stackoverflow.com/questions/56373198/get-xaringan-incremental-animations-to-print-to-pdf/56374619#56374619
  .has-continuation {
    display: block !important;
  }
}
&lt;/style&gt;




# Table of contents

&lt;br&gt;


1. [Iteration](#iteration)

2. [Automation and scripting](#automation)

3. [Scheduling](#scheduling)

4. [Debugging](#debugging)




&lt;!-- ############################################ --&gt;
---
class: inverse, center, middle
name: iteration

# Iteration

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px style="width:1000px; margin:auto;"/&gt;&lt;/html&gt;


---

# Iteration

### The ubiquity of iteration

- Often we have to run the same task over and over again, with minor variations. Examples:
  - Standardize values of a variable
  - Recode all numeric variables in a dataset
  - Running multiple models with varying covariate sets
- A benefit of scripting languages in data (as opposed to point-and-click solutions) is that we can easily automate the process of iteration

--

### Ways to iterate

- A simple approach is to copy-and-paste code with minor modifications (→ "[duplicate code](https://en.wikipedia.org/wiki/Duplicate_code)", → "[copy-and-paste programming](https://en.wikipedia.org/wiki/Copy-and-paste_programming)"). This is lazy, error-prone, not very efficient, and violates the "[Don't repeat yourself](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself)" (DRY) principle. 
- In R, [vectorization](https://adv-r.hadley.nz/perf-improve.html#vectorise), that is applying a function to every element of a vector at once, already does a good share of iteration for us.
- `for()` [loops](https://r4ds.hadley.nz/iteration.html) are intuitive and straightforward to build, but sometimes not very efficient.
- Finally, we learned about functions. Now, we learn how to unleash their power by applying them to anything we interact with in R at scale.


---
# A simple example

.pull-left[

## Task

Say we want to double each element in a numeric vector, `x = c(1, 2, 3, 4, 5)`. Here are some different approaches to achieve this:

### 1. Manually (sometimes: copying and pasting code)


``` r
R&gt; x &lt;- c(1, 2, 3, 4, 5)
R&gt; x_doubled &lt;- c(2, 4, 6, 8, 10)
```

### 2. Vectorization


``` r
R&gt; x &lt;- c(1, 2, 3, 4, 5)
R&gt; x_doubled &lt;- x * 2
R&gt; x_doubled
```

```
   [1]  2  4  6  8 10
```
]

--

.pull-right[
### 3. `for()` loop


``` r
R&gt; x &lt;- c(1, 2, 3, 4, 5)
R&gt; x_doubled &lt;- numeric(length(x))
R&gt; for (i in seq_along(x)) {
+   x_doubled[i] &lt;- x[i] * 2
+ }
R&gt; x_doubled
```

```
   [1]  2  4  6  8 10
```

### 4. Using `purrr`


``` r
R&gt; library(purrr)
R&gt; x &lt;- c(1, 2, 3, 4, 5)
R&gt; x_doubled &lt;- map_dbl(x, ~ .x * 2)
R&gt; x_doubled
```

```
   [1]  2  4  6  8 10
```
]




---

# Iteration with purrr

.pull-left-wide[

### The tidyverse way to iterate

- For *real* functional programming in base R, we can use the `*apply()` family of functions (`lapply()`, `sapply()`, etc.). See [here](https://nsaunders.wordpress.com/2010/08/20/a-brief-introduction-to-apply-in-r/) for an excellent summary.
- In the tidyverse, this functionality comes with the `purrr` package.
- At its core is the `map*()` family of functions. 


### How `purrr` works

- The idea is always to **apply** a function to **x**, where x can be a list, vector, data.frame, or something more complex. 
- The output is then returned as output of a pre-defined type (e.g., a list).
]

.pull-right-small-center[
&lt;div align="center"&gt;
&lt;br&gt;
&lt;img src="pics/purrr.png" height=250&gt;
&lt;/div&gt;
]

---

# Iteration with purrr: map()

The `map*()` functions all follow a similar syntax:

&lt;div align="center"&gt;
`map(.x, .f, ...)`
&lt;/div&gt;

We use it to apply a function `.f` to each piece in `.x`. Additional arguments to `.f` can be passed on in `...`.

--

For instance, if we want to identify the object class of every column of a data.frame, we can write:


``` r
R&gt; map(starwars, class)
```

```
   $name
   [1] "character"
   
   $height
   [1] "integer"
   
   $mass
   [1] "numeric"
   
   $hair_color
   [1] "character"
   
   $skin_color
   [1] "character"
   
   $eye_color
   [1] "character"
   
   $birth_year
   [1] "numeric"
   
   $sex
   [1] "character"
   
   $gender
   [1] "character"
   
   $homeworld
   [1] "character"
   
   $species
   [1] "character"
   
   $films
   [1] "list"
   
   $vehicles
   [1] "list"
   
   $starships
   [1] "list"
```


---

# Iteration with purrr: map() *cont.*

By default, `map()` returns a list. But we can also use other `map*()` functions to give us an atomic vector of an indicated type (e.g., `map_int()` to return an integer vector, or `map_vec()` to return a vector that is the simplest common type).

Going back to the previous example, we can also use `map_chr()`, which returns a character vector:


``` r
R&gt; map_chr(starwars, class)
```

```
          name      height        mass  hair_color  skin_color   eye_color 
   "character"   "integer"   "numeric" "character" "character" "character" 
    birth_year         sex      gender   homeworld     species       films 
     "numeric" "character" "character" "character" "character"      "list" 
      vehicles   starships 
        "list"      "list"
```

--

The `purrr` function set is quite comprehensive. Be sure to check out the [cheat sheet](https://github.com/rstudio/cheatsheets/blob/master/purrr.pdf) and the [tutorials](https://jennybc.github.io/purrr-tutorial/index.html). You'll survive without `purrr` but you probably don't want to live without it. Together with `dplyr` it's easily the most powerful package for data wrangling in the tidyverse. If you master it, it will save you a lot of time and headaches.


---

# Iteration with purrr: map() *cont.*

&lt;div align="center"&gt;
&lt;img src="pics/purrr-cheatsheet.png" height=550&gt;
&lt;/div&gt;

---

# Iteration with purrr: map() *cont.*

&lt;div align="center"&gt;
&lt;img src="pics/purrr-cheatsheet-2.png" height=550&gt;
&lt;/div&gt;


---
# Another example

.pull-left[
## Task

Let's say we want to calculate the mean and standard deviation of height and mass for each species in the `starwars` dataset.


``` r
R&gt; # Load the starwars dataset
R&gt; data(starwars)
R&gt; 
R&gt; # Custom function for calculations
R&gt; calc_stats &lt;- function(df) {
+   df %&gt;%
+     summarise(
+       height_mean = mean(height, na.rm = TRUE),
+       height_sd = sd(height, na.rm = TRUE),
+       mass_mean = mean(mass, na.rm = TRUE),
+       mass_sd = sd(mass, na.rm = TRUE)
+     )
+ }
```
]

--

.pull-right[

``` r
R&gt; # Group by species and apply the custom function
R&gt; species_stats &lt;- starwars %&gt;%
+   group_by(species) %&gt;%
+   nest() # Nesting the data
R&gt; species_stats
```

```
   # A tibble: 38 × 2
   # Groups:   species [38]
      species        data              
      &lt;chr&gt;          &lt;list&gt;            
    1 Human          &lt;tibble [35 × 13]&gt;
    2 Droid          &lt;tibble [6 × 13]&gt; 
    3 Wookiee        &lt;tibble [2 × 13]&gt; 
    4 Rodian         &lt;tibble [1 × 13]&gt; 
    5 Hutt           &lt;tibble [1 × 13]&gt; 
    6 &lt;NA&gt;           &lt;tibble [4 × 13]&gt; 
    7 Yoda's species &lt;tibble [1 × 13]&gt; 
    8 Trandoshan     &lt;tibble [1 × 13]&gt; 
    9 Mon Calamari   &lt;tibble [1 × 13]&gt; 
   10 Ewok           &lt;tibble [1 × 13]&gt; 
   # ℹ 28 more rows
```
]


---
# Another example

.pull-left[
## Task

Let's say we want to calculate the mean and standard deviation of height and mass for each species in the `starwars` dataset.


``` r
R&gt; # Load the starwars dataset
R&gt; data(starwars)
R&gt; 
R&gt; # Custom function for calculations
R&gt; calc_stats &lt;- function(df) {
+   df %&gt;%
+     summarise(
+       height_mean = mean(height, na.rm = TRUE),
+       height_sd = sd(height, na.rm = TRUE),
+       mass_mean = mean(mass, na.rm = TRUE),
+       mass_sd = sd(mass, na.rm = TRUE)
+     )
+ }
```
]

.pull-right[

``` r
R&gt; # Group by species and apply the custom function
R&gt; species_stats &lt;- starwars %&gt;%
+   group_by(species) %&gt;%
+   nest() %&gt;% # Nesting the data
+   # purrr magic
+   mutate(stats = map(data, calc_stats))
R&gt; species_stats
```

```
   # A tibble: 38 × 3
   # Groups:   species [38]
      species        data               stats           
      &lt;chr&gt;          &lt;list&gt;             &lt;list&gt;          
    1 Human          &lt;tibble [35 × 13]&gt; &lt;tibble [1 × 4]&gt;
    2 Droid          &lt;tibble [6 × 13]&gt;  &lt;tibble [1 × 4]&gt;
    3 Wookiee        &lt;tibble [2 × 13]&gt;  &lt;tibble [1 × 4]&gt;
    4 Rodian         &lt;tibble [1 × 13]&gt;  &lt;tibble [1 × 4]&gt;
    5 Hutt           &lt;tibble [1 × 13]&gt;  &lt;tibble [1 × 4]&gt;
    6 &lt;NA&gt;           &lt;tibble [4 × 13]&gt;  &lt;tibble [1 × 4]&gt;
    7 Yoda's species &lt;tibble [1 × 13]&gt;  &lt;tibble [1 × 4]&gt;
    8 Trandoshan     &lt;tibble [1 × 13]&gt;  &lt;tibble [1 × 4]&gt;
    9 Mon Calamari   &lt;tibble [1 × 13]&gt;  &lt;tibble [1 × 4]&gt;
   10 Ewok           &lt;tibble [1 × 13]&gt;  &lt;tibble [1 × 4]&gt;
   # ℹ 28 more rows
```
]

---
# Another example

.pull-left[
## Task

Let's say we want to calculate the mean and standard deviation of height and mass for each species in the `starwars` dataset.


``` r
R&gt; # Load the starwars dataset
R&gt; data(starwars)
R&gt; 
R&gt; # Custom function for calculations
R&gt; calc_stats &lt;- function(df) {
+   df %&gt;%
+     summarise(
+       height_mean = mean(height, na.rm = TRUE),
+       height_sd = sd(height, na.rm = TRUE),
+       mass_mean = mean(mass, na.rm = TRUE),
+       mass_sd = sd(mass, na.rm = TRUE)
+     )
+ }
```
]

.pull-right[

``` r
R&gt; # Group by species and apply the custom function
R&gt; species_stats &lt;- starwars %&gt;%
+   group_by(species) %&gt;%
+   nest() %&gt;% # Nesting the data
+   # purrr magic
+   mutate(stats = map(data, calc_stats)) %&gt;% 
+   select(species, stats) %&gt;% # Select columns
+   unnest(stats) # Unnest the data
R&gt; species_stats
```

```
   # A tibble: 38 × 5
   # Groups:   species [38]
      species        height_mean height_sd mass_mean mass_sd
      &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
    1 Human                 178      12.0       81.3    19.3
    2 Droid                 131.     49.1       69.8    51.0
    3 Wookiee               231       4.24     124      17.0
    4 Rodian                173      NA         74      NA  
    5 Hutt                  175      NA       1358      NA  
    6 &lt;NA&gt;                  175      12.4       81      31.2
    7 Yoda's species         66      NA         17      NA  
    8 Trandoshan            190      NA        113      NA  
    9 Mon Calamari          180      NA         83      NA  
   10 Ewok                   88      NA         20      NA  
   # ℹ 28 more rows
```
]



&lt;!-- ############################################ --&gt;
---
class: inverse, center, middle
name: automation

# Automation and scripting
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px style="width:1000px; margin:auto;"/&gt;&lt;/html&gt;



---
# Automation

&lt;div align="center"&gt;
&lt;img src="pics/xkcd-automation.png" width="500"/&gt;
&lt;br&gt;
&lt;tt&gt;Credit&lt;/tt&gt; &lt;a href="https://xkcd.com/1319/"&gt;Randall Munroe/xkcd 1319&lt;/a&gt;
&lt;/div&gt;

---
# Automation

.pull-left-wide2[
### Motivation

- We spend [too much time](https://itchronicles.com/technology/repetitive-tasks-cost-5-trillion-annually/) on repetitive tasks.
- We're already automating using scripts that bundle multiple commands! Next step: The pipeline as a series of scripts and commands.
- Good pipelines are modular. But you don't want to trigger 10 scripts sequentially by hand.
- Some tasks are to be repeated on a regular basis (schedule).

### When automation makes sense

- The input is variable but the process of turning input into output is highly standardized.
- You use a diverse set of software to produce the output.
- Others (humans, machines) are supposed to run the analyses.
- Time saved by automation &gt;&gt; Time needed to automate.
]

.pull-right-small2[
### Different ways of doing it

We will consider automation

- using **R**,
- using the **Shell** and **RScript**,
- using **make**, and
- using dedicated **scheduling tools**.

&lt;div align="center"&gt;
&lt;img src="pics/automation-giphy.gif" width="400"/&gt;
&lt;/div&gt;
]



---
# Thinking in pipelines

.pull-left[
### Key characteristics
- Pipelines make complex projects easier to handle because they break up a monolithic script into **discrete, manageable chunks**.
- If properly done, each stage of the pipeline defines its input and its outputs.
- Pipeline modules **do not modify their inputs** (*idempotence*). Rerunning one module produces the same results as the previous run.

### Key advantages
- When you modify one stage of the pipeline, you only have to rerun the downstream, dependent stages.
- Division of labor is straightforward.
- Modules tend to be a lot easier to debug.
]

.pull-right[
&lt;br&gt;
&lt;div align="center"&gt;
&lt;img src="pics/berlin-pink-pipes.jpeg" width="450"/&gt;
&lt;/div&gt;
]




---
# A data science pipeline is a graph

.pull-left-small2[
### Wait what
- Scripts and data files are vertices of the graph.
- Dependencies between stages are edges of the graph.
- Pipelines are not necessarily DAGS. Recursive routines are imaginable (but to be avoided?).
- Also, scripts are not necessarily hierarchical (e.g., multiple different modeling approaches of the same data in different scripts).
- An automation script gives *one* order in which you can successfully run the pipeline.
]

.pull-right-wide2[
&lt;br&gt;
&lt;div align="center"&gt;
&lt;img src="pics/lotr-pipeline.png" width="600"/&gt;
&lt;/div&gt;
]


---
# An example pipeline

.pull-left-small[
In the following, we will work with this toy pipeline:&lt;sup&gt;1&lt;/sup&gt;

.footnote[&lt;sup&gt;1&lt;/sup&gt;Courtesy of [Jenny Bryan](https://github.com/STAT545-UBC/STAT545-UBC-original-website).]
]



.pull-right-wide[
]



---
# An example pipeline

.pull-left-small[
In the following, we will work with this toy pipeline:

- `00-packages.R` loads the packages necessary for analysis,
]

.pull-right-wide[
`00-packages.R`: 


``` r
R&gt; # install packages from CRAN
R&gt; p_needed &lt;- c("tidyverse" # tidyverse packages
+ )
R&gt; packages &lt;- rownames(installed.packages())
R&gt; p_to_install &lt;- p_needed[!(p_needed %in% packages)]
R&gt; if (length(p_to_install) &gt; 0) {
+   install.packages(p_to_install)
+ }
R&gt; lapply(p_needed, require, character.only = TRUE)
```
]

---
# An example pipeline

.pull-left-small[
In the following, we will work with this toy pipeline:

- `00-packages.R` loads the packages necessary for analysis,
- `01-download-data.R` downloads a spreadsheet, which is stored as `lotr_raw.tsv`,
]

.pull-right-wide[
`01-download-data.R`: 


``` r
R&gt; ## download raw data
R&gt; download.file(url = "http://bit.ly/lotr_raw-tsv", 
+                destfile = "lotr_raw.tsv")
```
]


---
# An example pipeline

.pull-left-small[
In the following, we will work with this toy pipeline:

- `00-packages.R` loads the packages necessary for analysis,
- `01-download-data.R` downloads a spreadsheet, which is stored as `lotr_raw.tsv`,
- `02-process-data.R` imports and processes the data and exports a clean spreadsheet as `lotr_clean.tsv`, and
]

.pull-right-wide[
`02-process-data.R`: 


``` r
R&gt; ## import raw data
R&gt; lotr_dat &lt;- read_tsv("lotr_raw.tsv")
R&gt; 
R&gt; ## reorder Film factor levels based on story
R&gt; old_levels &lt;- levels(as.factor(lotr_dat$Film))
R&gt; j_order &lt;- sapply(c("Fellowship", "Towers", "Return"),
+ 					function(x) grep(x, old_levels))
R&gt; new_levels &lt;- old_levels[j_order]
R&gt; 
R&gt; ## process data set 
R&gt; lotr_dat &lt;- lotr_dat %&gt;%
+   # apply new factor levels to Film
+ 	mutate(Film = factor(as.character(Film), new_levels),
+ 	# revalue Race
+ 	Race = recode(Race, `Ainur` = "Wizard", `Men` = "Man")) %&gt;%
+ ## &lt;skipping some steps here to avoid slide overflow&gt;
+ 
+ ## write data to file
+ write_tsv(lotr_dat, "lotr_clean.tsv")
```
]


---
# An example pipeline

.pull-left-small[
In the following, we will work with this toy pipeline:

- `00-packages.R` loads the packages necessary for analysis,
- `01-download-data.R` downloads a spreadsheet, which is stored as `lotr_raw.tsv`,
- `02-process-data.R` imports and processes the data and exports a clean spreadsheet as `lotr_clean.tsv`, and
- `03-plot.R` imports the clean dataset, produces a figure and exports it as `barchart-words-by-race.png`.
]

.pull-right-wide[
`03-plot.R`: 


``` r
R&gt; ## import clean data
R&gt; lotr_dat &lt;- read_tsv("lotr_clean.tsv") %&gt;% 
+ # reorder Race based on words spoken
+ mutate(Race = reorder(Race, Words, sum))
R&gt; 
R&gt; ## make a plot
R&gt; p &lt;- ggplot(lotr_dat, aes(x = Race, weight = Words)) + geom_bar()
R&gt; ggsave("barchart-words-by-race.png", p)
```
]


---
# An example pipeline





``` r
R&gt; slice_sample(lotr_dat, n = 10)
```

```
   # A tibble: 10 × 5
      Film                       Chapter                      Character Race  Words
      &lt;chr&gt;                      &lt;chr&gt;                        &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;
    1 The Return Of The King     64: The Mouth Of Sauron      Aragorn   Man      23
    2 The Fellowship Of The Ring 36: The Bridge Of Khazad-dûm Frodo     Hobb…     4
    3 The Two Towers             36: Isengard Unleashed       Saruman   Wiza…    50
    4 The Fellowship Of The Ring 42: The Great River          Sam       Hobb…    37
    5 The Return Of The King     42: Breaking The Gate Of Go… Gandalf   Wiza…    21
    6 The Two Towers             45: The Glittering Caves     Legolas   Elf      36
    7 The Two Towers             35: Helm's Deep              Rohan Wa… Man      22
    8 The Fellowship Of The Ring 33: Moria                    Aragorn   Man      31
    9 The Fellowship Of The Ring 43: Parth Galen              Aragorn   Man      79
   10 The Return Of The King     24: Courage Is The Best Def… Gothmog   Orc       4
```



---
# An example pipeline


``` r
R&gt; p &lt;- ggplot(lotr_dat, aes(x = Race, weight = Words)) + 
+   geom_bar() + theme_minimal()
```

&lt;div align="center"&gt;
&lt;br&gt;
&lt;img src="examples/01-automation-just-r/barchart-words-by-race.png" width="400"/&gt;
&lt;/div&gt;


---
# Automation using pipelines in R

.pull-left[
### Motivation and usage
- The `source()` function reads and parses R code from a file or connection. 
- We can build a pipeline by sourcing scripts sequentially.
- This pipeline is usually stored in a "master/main" script.
- The removal of previous work is optional and maybe redundant. Often the data is overwritten by default.
- It is recommended that the individual scripts are (partial) standalones, i.e. that they import all data they need by default (loading the packages could be considered an exception). 
- Note that as long as the environment is not reset, it remains intact across scripts, which is a potential source of error and confusion.
]

--

.pull-right[
### Example

The master script `master.R`:


``` r
R&gt; ## clean out any previous work
R&gt; outputs &lt;- c("lotr_raw.tsv",
+ 	          "lotr_clean.tsv",
+               list.files(pattern = "*.png$"))
R&gt; file.remove(outputs)
R&gt; 
R&gt; ## run scripts
R&gt; source("00-packages.R")
R&gt; source("01-download-data.R")
R&gt; source("02-process-data.R")
R&gt; source("03-plot.R")
```
]


---
# Automation using the Shell and Rscript

.pull-left[
### Motivation and usage
- Alternatively to using an R master script, we can also run the pipeline from the command line.
- Note that here, the environments don't carry over across `Rscript` calls. The scripts definitely have to run in a standalone fashion (i.e., load packages, import all necessary data, etc.).
- The working directory should be set either in the script(s) or in the shell with `cd`.
]

--

.pull-right[
### Example

The master script `master.sh`:

```bash
#!/bin/sh
cd /Users/simonmunzert/github/examples/02-automation-shell-rscript
set -eux
Rscript 01-download-data.R
Rscript 02-process-data.R
Rscript 03-plot.R
```

The `set` command allows to adjust some base shell parameters:
- `-e`: Stop at first error
- `-u`: Undefined variables are an error
- `-x`: Print each command as it is run

For more information on `set`, see [here](http://linuxcommand.org/lc3_man_pages/seth.html).
]



---
# Automation using the Shell and Rscript

.pull-left[
### Motivation and usage
- Alternatively to using an R master script, we can also run the pipeline from the command line.
- Note that here, the environments don't carry over across `Rscript` calls. The scripts definitely have to run in a standalone fashion (i.e., load packages, import all necessary data, etc.).
- The working directory should be set either in the script(s) or in the shell with `cd`.
- One advantage of this approach is that it can be easily coupled with other command line tools, building a **polyglot pipeline**.
]


.pull-right[
### Example

The master script `master.sh`:

```bash
#!/bin/sh
cd /Users/simonmunzert/github/examples/02-automation-shell-rscript
set -eux
*curl -L http://bit.ly/lotr_raw-tsv &gt; lotr_raw.tsv
Rscript 02-process-data.R
Rscript 03-plot.R
```

The `set` command allows to adjust some base shell parameters:
- `-e`: Stop at first error
- `-u`: Undefined variables are an error
- `-x`: Print each command as it is run

For more information on `set`, see [here](http://linuxcommand.org/lc3_man_pages/seth.html).
]



---
# Automation using Make

.pull-left-vwide[
### Motivation and usage
- [Make](https://en.wikipedia.org/wiki/Make_%28software%29) is an automation tool that allows us to specify and manage build processes.
- It is commonly run via the shell.
- At the heart of a make operation is the `makefile` (or `Makefile`, `GNUmakefile`), a script which serves as a recipe for the building process.
- A `makefile` is written following a particular syntax and in a declarative fashion.
- Conceptually, the recipe describes which files are built how and using what input.

### Advantages of Make
- It looks at which files you have and automatically figures out how to create the files that you have. For complex pipelines this "automation of the automation process" can be very helpful.
- While shell scripts give *one* order in which you can successfully run the pipeline, Make will figure out the parts of the pipeline (and their order) that are needed to build a desired target.
]

.pull-right-vsmall[
&lt;div align="center"&gt;
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;img src="pics/gnu-make.png" width="250"/&gt;
&lt;/div&gt;
]


---
# Automation using Make (cont.)

.pull-left-small[
### Basic syntax

Each batch of lines indicates 
- a file to be created (the target),
- the files it depends on (the prerequisites), and 
- set of commands needed to construct the target from the dependent files.

Dependencies propagate.
- To create any of the `png` figures, we need `lotr_clean.tsv`.
- If this file changes, the `png`s change as well when they're built.
]

.pull-right-wide[

### Example `makefile`

```bash
all: lotr_clean.tsv barchart-words-by-race.png words-histogram.png

lotr_raw.tsv:
	curl -L http://bit.ly/lotr_raw-tsv &gt; lotr_raw.tsv

lotr_clean.tsv: lotr_raw.tsv 02-process-data.R
	Rscript 02-process-data.R

barchart-words-by-race.png: lotr_clean.tsv 03-plot.R
	Rscript 03-plot.R

words-histogram.png: lotr_clean.tsv
	Rscript -e 'library(ggplot2); 
	qplot(Words, data = read.delim("$&lt;"), geom = "histogram"); 
	ggsave("$@")'
	rm Rplots.pdf

clean:
	rm -f lotr_raw.tsv lotr_clean.tsv *.png

```
]



---
# Automation using Make (cont.)

.pull-left-small[

### Getting Make to run

- Using the command line, go into the directory for your project.
- Create the `Makefile` file.
- The most basic Make commands are `make all` and `make clean` which builds (or deletes) all output as specified in the script.
]

.pull-right-wide[

### Example `makefile`

```bash
*all: lotr_clean.tsv barchart-words-by-race.png words-histogram.png

lotr_raw.tsv:
	curl -L http://bit.ly/lotr_raw-tsv &gt; lotr_raw.tsv

lotr_clean.tsv: lotr_raw.tsv 02-process-data.R
	Rscript 02-process-data.R

barchart-words-by-race.png: lotr_clean.tsv 03-plot.R
	Rscript 03-plot.R

words-histogram.png: lotr_clean.tsv
	Rscript -e 'library(ggplot2); 
	qplot(Words, data = read.delim("$&lt;"), geom = "histogram"); 
	ggsave("$@")'
	rm Rplots.pdf

*clean:
*   rm -f lotr_raw.tsv lotr_clean.tsv *.png
```
]


---
# Automation using Make - FAQ

### Does it work on Windows?

To install an run `make` on Windows, check out [these instructions](https://stat545.com/make-windows.html).

### Where can I learn more?

If you consider working with Make, check out the [official manual](https://www.gnu.org/software/make/manual/make.html), [this helpful tutorial](https://makefiletutorial.com/), Karl Broman's [excellent minimal make introduction](https://kbroman.org/minimal_make/), or [this Stat545 piece](https://stat545.com/automation-overview.html). 

.pull-left-vwide[
### This is dusty technology. Are there alternatives?

In the context of data science with R, the `targets` package is an interesting option. It provides R functionality to define a Make-stype pipeline. Check out the [overview](https://docs.ropensci.org/targets/) and [manual](https://books.ropensci.org/targets/).
]

.pull-right-vsmall[
&lt;div align="center"&gt;
&lt;br&gt;
&lt;img src="pics/targets-hex.png" width="150"/&gt;
&lt;/div&gt;
]



&lt;!-- ############################################ --&gt;
---
class: inverse, center, middle
name: scheduling

# Scheduling
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px style="width:1000px; margin:auto;"/&gt;&lt;/html&gt;


---
# Scheduling

&lt;div align="center"&gt;
&lt;img src="pics/xkcd-time.png" width="600"/&gt;
&lt;br&gt;
&lt;tt&gt;Credit&lt;/tt&gt; &lt;a href="https://xkcd.com/1205/"&gt;Randall Munroe/xkcd 1205&lt;/a&gt;
&lt;/div&gt;


---
# Scheduling scripts and processes

.pull-left-wide[
### Motivation
- So far, we have automated data science pipelines.
- But the execution of these pipelines still needs to be triggered.
- In some cases, it is desirable to also **automate the initialization** of R scripts (or any processes for that matter) **on a regular basis**, e.g. weekly, daily, on logon, etc.
- This makes particular sense when you have moving parts in your pipeline (most likely: data).

### Common scenarios for scheduling

1. You fetch data from the web on a regular basis (e.g., via scraping scripts or APIs).
2. You generate daily/weekly/monthly reports/tweets based on changing data.
3. You build an alert control system informing you about anomalies in a database.

]

.pull-right-small[
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;div align="center"&gt;
&lt;img src="pics/robot-clock-giphy.gif" width="400"/&gt;
&lt;/div&gt;
`Credit` [Simone Giertz](https://www.youtube.com/watch?v=Lh2-iJj3dI0)
]



---
# Scheduling scripts and processes on Windows

.pull-left-small2[
### Scheduling options
- Schedule tasks on Windows with [Windows Task Scheduler](https://en.wikipedia.org/wiki/Windows_Task_Scheduler).
- Manage them via a GUI (→ Control Panel) or the command line using `schtasks.exe`.
- The R package [`taskscheduleR`](https://cran.r-project.org/web/packages/taskscheduleR/vignettes/taskscheduleR.html) provides a programmable R interface to the WTS.

&lt;div align="center"&gt;
&lt;img src="pics/windows-task-scheduler.png" width="400"/&gt;
&lt;/div&gt;
]

.pull-right-wide2[
### `taskscheduleR` example


``` r
R&gt; library(taskscheduleR)
R&gt; myscript &lt;- "examples/scrape-wiki.R"
R&gt; ## Run every 5 minutes, starting from 10:40
R&gt; taskscheduler_create(
+   taskname = "WikiScraperR_5min", rscript = myscript,
+   schedule = "MINUTE", starttime = "10:40", modifier = 5)
R&gt; 
R&gt; ## Run every week on Saturday and Sunday at 09:10
R&gt; taskscheduler_create(
+   taskname = "WikiScraperR_SatSun", rscript = myscript, 
+   schedule = "WEEKLY", starttime = "09:10", 
+   days = c('SAT', 'SUN'))
R&gt; 
R&gt; ## Delete task
R&gt; taskscheduler_delete("WikiScraperR_SatSun")
R&gt; 
R&gt; ## Get a data.frame of all tasks
R&gt; tasks &lt;- taskscheduler_ls()
R&gt; str(tasks)
```
]


---
# Scheduling scripts and processes on a Mac

.footnote[&lt;sup&gt;1&lt;/sup&gt;For more resources on scheduling with `launchd`, check out [this](https://babichmorrowc.github.io/post/launchd-jobs/) and [this](https://towardsdatascience.com/a-step-by-step-guide-to-scheduling-tasks-for-your-data-science-project-d7df4531fc41).]

.pull-left-small3[
### Scheduling options
- On macOS you can schedule background jobs using [`cron`](https://en.wikipedia.org/wiki/Cron) and [`launchd`](https://en.wikipedia.org/wiki/Launchd).
- `launchd`&lt;sup&gt;1&lt;/sup&gt; was created by Apple as a replacement for the popular Linux utility `cron` ([deprecated](https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/ScheduledJobs.html) but still usable). 
- The R package [`cronR`](https://cran.r-project.org/web/packages/cronR/index.html) provides a programmable R interface.
- `cron` syntax for more complex scheduling:

&lt;div align="center"&gt;
&lt;img src="pics/cron-syntax.png" width="380"/&gt;
&lt;/div&gt;
]

.pull-right-wide3[
### `cronR` example


``` r
R&gt; library(cronR)
R&gt; myscript &lt;- "examples/scrape-wiki.R"
R&gt; # Create bash code for crontab to execute R script
R&gt; cmd &lt;- cron_rscript(myscript)
R&gt; 
R&gt; ## Run every minute
R&gt; cron_add(command = cmd, frequency = 'minutely',
+           id = 'ScraperR_1min', description = 'Every 1min')
R&gt; 
R&gt; ## Run every 15 minutes (using cron syntax)
R&gt; cron_add(cmd, frequency = '*/15 * * * *', 
+           id = 'ScraperR_15min', description = 'Every 15 mins') 
R&gt; 
R&gt; ## Check number of running cronR jobs
R&gt; cron_njobs()
R&gt; 
R&gt; ## Delete task
R&gt; cron_rm("WikiScraperR_1min", ask = TRUE)
```
]




&lt;!-- ############################################ --&gt;
---
class: inverse, center, middle
name: debugging

# Strategies for debugging
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px style="width:1000px; margin:auto;"/&gt;&lt;/html&gt;


---
# What's debugging?

.pull-left[
### Straight from the [Wikipedia](https://en.wikipedia.org/wiki/Debugging)

"Debugging is the process of finding and resolving bugs (defects or problems that prevent correct operation) within computer programs, software, or systems."

### A famous (yet not the first) bug:

The term "bug" was used in an account by computer pioneer [Grace Hopper](https://en.wikipedia.org/wiki/Grace_Hopper) (see on the right). While she was working on a [Mark II](https://en.wikipedia.org/wiki/Harvard_Mark_II) computer at Harvard University, her associates discovered a moth stuck in a relay and thereby impeding operation, whereupon she remarked that they were "debugging" the system. This bug was carefully removed and taped to the log book (see on the right).
]

.pull-right-center[
&lt;div align="center"&gt;
&lt;br&gt;
&lt;img src="pics/grace-hopper.jpg" width="200"/&gt;
&lt;br&gt;
&lt;i&gt;Above:&lt;/i&gt; Grace Hopper, &lt;i&gt;Below:&lt;/i&gt; The bug
&lt;br&gt;
&lt;img src="pics/computer-bug-hopper.jpeg" width="300"/&gt; 
&lt;/div&gt;
]


---
# Why debugging matters

.pull-left-wide[
The Wikipedia [list of software bugs](https://en.wikipedia.org/wiki/List_of_software_bugs) with significant consequences is growing and you don't want to be on it. 

NASA software engineers are [famous for producing bug-free code](https://www.bugsplat.com/blog/less-serious/why-nasa-code-doesnt-crash/). This was learned the hard and costly way though. Some highlights from space:

- 1962: A booster went off course during launch, resulting in the [destruction of NASA Mariner 1](https://www.youtube.com/watch?v=CkOOazEJcUc) . This was the result of the failure of a transcriber to notice an overbar in a handwritten specification for the guidance program, resulting in an incorrect formula the FORTRAN code.
- 1999: [NASA's Mars Climate Orbiter was destroyed](https://www.youtube.com/watch?v=lcYkOh4nweE), due to software on the ground generating commands based on parameters in pound-force (lbf) rather than newtons (N)
- 2004: [NASA's Spirit rover became unresponsive](https://www.youtube.com/watch?v=7V54LRRJaGk) on January 21, 2004, a few weeks after landing on Mars. Engineers found that too many files had accumulated in the rover's flash memory (the problem could be fixed though by deleting unnecessary files, and the Rover lived happily ever after. Until it [froze to death in 2011](https://en.wikipedia.org/wiki/Spirit_(rover)).
]

.pull-right-small[
&lt;div align="center"&gt;
&lt;br&gt;&lt;br&gt;
&lt;img src="pics/nasa-coding-error.png" width="400"/&gt;
&lt;img src="pics/nasa-coding-error-2.png" width="400"/&gt;
&lt;/div&gt;
]


---
# Why debugging matters (cont.)

&lt;div align="center"&gt;
&lt;br&gt;
&lt;img src="pics/excel-error-paper-2.jpeg" height="500"/&gt;
&lt;img src="pics/excel-error-paper.png" height="500"/&gt;
&lt;/div&gt;



---
# Why debugging matters (cont.)

.pull-left-center[
&lt;div align="center"&gt;
&lt;br&gt;
&lt;img src="pics/fb-socsci1-1.png" width="550"/&gt;
&lt;img src="pics/fb-socsci1-2.png" width="550"/&gt;
&lt;img src="pics/fb-socsci1-3.png" width="550"/&gt;
&lt;/div&gt;
`Source` [Washington Post](https://www.washingtonpost.com/technology/2021/09/10/facebook-error-data-social-scientists/)
]


.pull-right-center[
&lt;div align="center"&gt;
&lt;br&gt;
&lt;img src="pics/fb-socsci1-4.png" width="450"/&gt;
&lt;img src="pics/fb-socsci1-5.png" width="450"/&gt;
&lt;/div&gt;
`Source` [Solomon Messing / Twitter](https://twitter.com/solomonmg/status/1436742352039669760)
]



---
# A general strategy for debugging

.pull-left-vsmall[]

.pull-right-wide[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

## 1. Google

## 2. Reset

## 3. Debug

## 4. Deter
]


---
# Google

.footnote[&lt;sup&gt;1&lt;/sup&gt;Do you get an error message you don't understand? That's good news actually, because the really nasty bugs come without errors. ]

.pull-left-wide2[
According to [this analysis](https://github.com/noamross/zero-dependency-problems/blob/master/misc/stack-overflow-common-r-errors.md), the most common error types in R are:&lt;sup&gt;1&lt;/sup&gt;

1. `Could not find function` errors, usually caused by typos or not loading a required package.
2. `Error in if` errors, caused by non-logical data or missing values passed to R's `if` conditional statement.
3. `Error in eval` errors, caused by references to objects that don't exist.
4. `Cannot open` errors, caused by attempts to read a file that doesn't exist or can't be accessed.
5. `no applicable method` errors, caused by using an object-oriented function on a data type it doesn't support.
6. `subscript out of bounds` errors, caused by trying to access an element or dimension that doesn't exist
7. Package errors caused by being unable to install, compile or load a package.
]

--

.pull-right-small2[
Whenever you see an error message, start by [googling](https://lmgtfy.app/?q=Error+in+interpretative_method+%3A+%20+%20could+not+find+function+%22interpretative_method%22&amp;iie=1) it. Improve your chances of a good match by removing any variable names or values that are specific to your problem. Also, look for [Stack Overflow](https://stackoverflow.com/questions/tagged/r) posts and list of answers.

&lt;div align="center"&gt;
&lt;img src="pics/google-programming.jpeg" height="250"/&gt;
&lt;/div&gt;

]


---
# Reset

.pull-left[
- If at first you don't succeed, try exactly the same thing again.
- Have you tried turning it off and on again?
- Do you use `rm(list = ls())`? Don't. Packages remain loaded, options and environment variables set, ... all possible sources of error!
- A fresh start clears the workspace, resets options, environment variables, and the path.
- While we're at it, check out James Wade's advice ["How I set up RStudio for Efficient Coding" (YouTube)](https://www.youtube.com/watch?v=p-r-AWR3-Es).
]

.pull-right[
&lt;div align="center"&gt;
&lt;img src="pics/restart-r-1.png" width="350"/&gt;&lt;br&gt;
&lt;img src="pics/restart-r-2.png" width="350"/&gt;
&lt;/div&gt;
]


---
# Debug

### Make the error repeatable. 

- Execute the code many times as you consider and reject hypotheses. To make that iteration as quick possible, it’s worth some upfront investment to make the problem both easy and fast to reproduce.
- Work with reproducible and minimal examples by removing innocuous code and simplifying data.
- Consider automated testing. Add some nearby tests to ensure that existing good behaviour is preserved. 

### Track the error down.

- Execute code step by step and inspect intermediate outputs. 
- Adopt the scientific method: Generate hypotheses, design experiments to test them, and record your results. 

### Once found, fix the error and test it.

- Ensure you haven’t introduced any new bugs in the process. 
- Make sure to carefully record the correct output, and check against the inputs that previously failed.
- Reset and run again to make sure everything still works. 


---
# Deter

.pull-left-wide2[

### Defensive programming

- **Pay attention.** Do results make sense? Do they look different from previous results? Why?
- **Know what you're doing**, and what you're expecting.
  - Avoid functions that return different types of output depending on their input, e.g., `[]` and `sapply()`.
  - Be strict about what you accept (e.g., only scalars). 
  - Avoid functions that use non-standard evaluation (e.g., `with()`)
- **Fail fast**.
  - As soon as something wrong is discovered, signal an error. 
  - Add tests (e.g., with the `testthat` package).
  - Practice good condition/exception handling, e.g., with `try()` and `tryCatch()`. 
  - Write error messages for humans.

]

.pull-right-small3[
### Transparency

- Collaborate! [Pair programming](https://en.wikipedia.org/wiki/Pair_programming) is an established software development technique that increases code robustness. It also works [from remote](https://ivelasq.rbind.io/blog/vscode-live-share/).
- Be transparent! Let others access your code and comment on it.

&lt;div align="center"&gt;
&lt;img src="pics/pair-programming-its-not-for-everyone.jpeg" width="350"/&gt;
&lt;/div&gt;
]



---
# Debugging R: What you get

&lt;br&gt;
&lt;br&gt;
&lt;tt&gt;
Error : .onLoad failed in loadNamespace() for 'rJava', details: &lt;br&gt;
call: dyn.load(file, DLLpath = DLLpath, ...) &lt;br&gt;
error: unable to load shared object '/Users/janedoe/Library/R/3.6/library/rJava/libs/rJava.so':  &lt;br&gt;
libjvm.so: cannot open shared object file: No such file or directory  &lt;br&gt;
Error: loading failed  &lt;br&gt;
Execution halted  &lt;br&gt;
ERROR: loading failed  &lt;br&gt;
* removing '/Users/janedoe/Library/R/3.6/library/rJava/' &lt;br&gt;
Warning in install.packages : &lt;br&gt;
installation of package 'rJava' had non-zero exit status
&lt;/tt&gt;

&lt;br&gt;
`Credit` [Jenny Bryan](https://github.com/jennybc/debugging)


---
# Debugging R: What you see


&lt;br&gt;
&lt;br&gt;
&lt;tt&gt;
&lt;span style = "color:red"&gt;Error&lt;/span&gt; : blah &lt;span style = "color:red"&gt;failed&lt;/span&gt; blah blah() blah 'blah', blah: &lt;br&gt;
call: blah.blah(blah, blah = blah, ...) &lt;br&gt;
&lt;span style = "color:red"&gt;error&lt;/span&gt;: &lt;span style = "color:red"&gt;unable&lt;/span&gt; to blah blah blah '/blah/blah/blah/blah/blah/blah/blah/blah/blah.so':  &lt;br&gt;
blah.so: &lt;span style = "color:red"&gt;cannot&lt;/span&gt; open blah blah blah: &lt;span style = "color:red"&gt;No&lt;/span&gt; blah blah blah blah  &lt;br&gt;
&lt;span style = "color:red"&gt;Error&lt;/span&gt;: blah &lt;span style = "color:red"&gt;failed&lt;/span&gt;  &lt;br&gt;
blah blah  &lt;br&gt;
&lt;span style = "color:red"&gt;ERROR&lt;/span&gt;: blah &lt;span style = "color:red"&gt;failed&lt;/span&gt;  &lt;br&gt;
* removing '/blah/blah/blah/blah/blah/blah/blah/' &lt;br&gt;
&lt;span style = "color:red"&gt;Warning&lt;/span&gt; in blah.blah : &lt;br&gt;
blah of blah 'blah' blah blah-blah blah blah
&lt;/tt&gt;

&lt;br&gt;
`Credit` [Jenny Bryan](https://github.com/jennybc/debugging)


---
# Strategies to debug your R code

Sometimes the mistake in your code is hard to diagnose, and googling doesn't help. Here are a couple of strategies to debug your code:

- Use `traceback()` to determine where a given error is occurring.

- Output diagnostic information in code with `print()`, `cat()` or `message()` statements.

- Use `browser()` to open an interactive debugger before the error

- Use `debug()` to automatically open a debugger at the start of a function call.

- Use `trace()` to make temporary code modifications inside a function that you don't have easy access to.


---
# Locating errors with traceback()

.pull-left[

### Motivation and usage
- When an error occurs with an unidentifiable error message or an error message that you are in principle familiar with but cannot locate its sources, the `traceback()` function comes in handy.
- The `traceback()` function prints the sequence of calls that led to an uncaught error.
- The `traceback()` output reads from bottom to top.
- Note that errors caught via `try()` or `tryCatch()` do not generate a traceback!
-  If you’re calling code that you `source()`d into R, the traceback will also display the location of the function, in the form `filename.r#linenumber`. 
]

--

.pull-right[
### Example

In the call sequence below, the execution of `g()` triggers an error:


``` r
R&gt; f &lt;- function(x) x + 1
R&gt; g &lt;- function(x) f(x)
R&gt; g("a")
```

```r 
#&gt; Error in x + 1 : non-numeric argument to binary operator
```

Doing the traceback reveals that the function call f(x) is what lead to the error:


``` r
R&gt; traceback()
```

```r 
#&gt; 2: f(x) at #1
#&gt; 1: g("a")
```
]

---
# Interactive debugging with browser()

.pull-left[
### Motivation and usage
- Sometimes, you need more information than the precise location of an error in a function to fix it. 
- The interactive debugger lets you pause the run of a function and interactively explore its state.
- Two options to enter the interactive debugger: 
  1. Through RStudio's "Rerun with Debug" tool, shown to the right of an error message.
  2. You can insert a call to `browser()` into the function at the stage where you want to pause, and re-run the function.
- In either case, you’ll end up in an interactive environment inside the function where you can run arbitrary R code to explore the current state. You’ll know when you’re in the interactive debugger because you get a special prompt, `Browse[1]&gt;`. 
]

--

.pull-right[
### Example


``` r
R&gt; h &lt;- function(x) x + 3
R&gt; g &lt;- function(b) {
*+   browser()
+   h(b)
+ }
R&gt; g(10)
```

Some useful things to do are:

1. Use `ls()` to determine what objects are available in the current
   environment.
2. Use `str()`, `print()` etc. to examine the objects.
3. Use `n` to evaluate the next statement.
4. Use `s`: like `n` but also step into function calls.
5. Use `where` to print a stack trace (→ traceback).
6. Use `c` to exit debugger and continue execution.
7. Use `Q` to exit debugger and return to the R prompt.
]



---
# Debugging other peoples' code


.pull-left[
### Motivation
- Sometimes the error is outside your code in a package you're using, you might still want to be able to debug.
- Two options:
  1. Get a local version of the package code and debug as if it were your own.
  2. Use functions which which allow you to start a browser in existing functions, including `recover()` and `debug()`.
]

.pull-right[
]



---
# Debugging other peoples' code (cont.)

.pull-left-small[
### Motivation
- `recover()` serves as an alternative error handler which you activate by calling `options(error = recover)`.
- You can then select from a list of current calls to browse.
- `options(error = NULL)` turns off this debugging mode again.
- A simpler alternative is `options(error = browser)`, but this only allows you to browse the call where the error occurred.
]

--

.pull-right-wide[
### Example

- Activate debugging mode; then execute (flawed) function:


``` r
*R&gt; options(error = recover)
R&gt; lm(mpg ~ wt, data = "mtcars")
```

```r 
Error in model.frame.default(formula = mpg ~ wt, data = "mtcars", drop.unused.levels = TRUE) 
 'data' must be a data.frame, environment, or list
 
Enter a frame number, or 0 to exit   

1: lm(mpg ~ wt, data = "mtcars")
2: eval(mf, parent.frame())
3: eval(mf, parent.frame())

Selection: 
```

- Deactivate debugging mode: 


``` r
*R&gt; options(error = NULL)
```
]

---
# Debugging other peoples' code (cont.)

.pull-left[
### Motivation
- `debug()` activates the debugger on any function, including those in packages (see on the right). `undebug()` deactivates the debugger again.
- Some functions in another package are easier to find than others. There are
  - *exported* functions which are available outside of a package and
  - *internal* functions which are only available within a package.
- To find (and debug) exported functions, use the `::` syntax, as in `ggplot2::ggplot`.
- To find un-exported functions, use the `:::` syntax, as in `ggplot2:::check_required_aesthetics`.
]

--

.pull-right[
### Example

- Activate debugging mode for `lm()` function; then execute function:


``` r
*R&gt; debug(stats::lm)
R&gt; lm(mpg ~ weight, data = "mtcars")
```

- Interactive debugging mode for `lm()` is entered; use the common `browser()` functionality to navigate:

```r 
debugging in: lm(mpg ~ weight, data = mtcars)
debug: {
    ret.x &lt;- x
    ...
Browse[2]&gt; 
```

- Deactivate debugging mode: 


``` r
*R&gt; undebug(stats::lm)
```
]


---
# Debugging in RStudio

&lt;div align="center"&gt;
&lt;img src="pics/rstudio-debug-mode.png" width="1100"/&gt;
&lt;/div&gt;



---
# More on debugging R

.pull-left[
&lt;br&gt;&lt;br&gt;&lt;br&gt;

### Further reading

- [12-minute video](https://vimeo.com/99375765) on debugging in R
- Jenny Bryan's [talk on debugging](https://github.com/jennybc/debugging) at  rstudio::conf 2020
- Jenny Bryan and Jim Hester's "What They Forgot to Teach You About R", Chapter 11: [Debugging R code](https://rstats.wtf/debugging-r)
- Jonathan McPherson's [Debugging with RStudio](https://support.rstudio.com/hc/en-us/articles/205612627-Debugging-with-RStudio)
]

.pull-right[
&lt;br&gt;
&lt;div align="center"&gt;
&lt;img src="pics/classy-bear-debugging.jpeg" width="450"/&gt;
&lt;/div&gt;
]


---
# Next steps

&lt;br&gt;

### Assignment 1 and Quiz 1

Don't forget to submit your solutions for Assignment 1. Also, Quiz 1 is online!


### Next lecture

We're going to dig into the world wide web...

&lt;b&gt;Important:&lt;/b&gt; The lecture is going to take place on Wednesday, 8-10am, in the Forum! If your regular lab is schedule for that slot, please visit the lab session at the ordinary lecture slot instead (Mon, 10-12h). The lecture will be recorded and made available in case you cannot attend.







    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false,
  "ratio": "16:9",
  "hash": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
  .logo {
    background-image: url("../hertieschool-neg.svg");
    background-size: contain;
    background-repeat: no-repeat;
    position: absolute;
    top: 1.5em;
    right: 1em;
    width: 150px;
    height: 128px;
    z-index: 0;
  }
</style>
  
  <script>
  document
.querySelectorAll(
  '.remark-slide-content' +
    ':not(.title-slide)' +
    ':not(.inverse)' +
	
    // add additional classes to exclude here, e.g.
  // ':not(.inverse)' +
    ':not(.hide-logo)'
)
.forEach(el => {
  el.innerHTML += '<div class="logo"></div>';
});
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
